NETWORK=${1:-testnet}

HOST=http://35.180.120.244

TAR_FILE=${NETWORK}_db_latest.tgz
TAR_FILE_MD5=${TAR_FILE}_md5

REMOTE_TAR_FILE=$HOST/$TAR_FILE
REMOTE_TAR_FILE_MD5=$HOST/$TAR_FILE_MD5


echo "downloading $REMOTE_TAR_FILE into $TAR_FILE"
curl $REMOTE_TAR_FILE --output $TAR_FILE

echo "downloading $REMOTE_TAR_FILE_MD5 into $TAR_FILE_MD5"
curl $REMOTE_TAR_FILE_MD5 --output $TAR_FILE_MD5

# verify checksum
TAR_FILE_CHECKSUM=$(md5sum $TAR_FILE | awk '{ print $1 }')
echo "downloaded tar $TAR_FILE checksum:\n $TAR_FILE_CHECKSUM"
EXPECTED_CHECKSUM=$(cat $TAR_FILE_MD5)
echo "expected checksum:\n $EXPECTED_CHECKSUM"
# check equality of $TAR_FILE_CHECKSUM and $EXPECTED_CHECKSUM
if [ "$TAR_FILE_CHECKSUM" != "$EXPECTED_CHECKSUM" ]; 
  then 
    echo "checksums doesn't match!" 
    echo "exit" 
    exit 1
fi
echo "checksums match!" 

echo $TAR_FILE